@startuml MemFlow System Overview

skinparam backgroundColor #FEFEFE
skinparam componentStyle rectangle
skinparam defaultFontName Arial
skinparam shadowing false

' Color scheme
skinparam component {
    BackgroundColor<<Frontend>> #E3F2FD
    BorderColor<<Frontend>> #1976D2
    BackgroundColor<<Backend>> #FFF3E0
    BorderColor<<Backend>> #F57C00
    BackgroundColor<<CLI>> #E8F5E9
    BorderColor<<CLI>> #388E3C
    BackgroundColor<<Database>> #F3E5F5
    BorderColor<<Database>> #7B1FA2
    BackgroundColor<<External>> #FFEBEE
    BorderColor<<External>> #C62828
    BackgroundColor<<Worker>> #FFF9C4
    BorderColor<<Worker>> #F57F17
}

title MemFlow - Memory Forensics Automation System Architecture (Updated)

' ============================================
' FRONTEND LAYER (Flutter Desktop Application)
' ============================================
package "Flutter Desktop Application" <<Frontend>> {
    
    component "main.dart" as MainApp <<Frontend>>
    
    package "Screens" {
        component [LoginScreen] <<Frontend>>
        component [NewDashboardScreen] <<Frontend>>
        component [UploadCaseScreen] <<Frontend>>
        component [OperationsScreen] <<Frontend>>
        component [ReportsScreen] <<Frontend>>
        component [SettingsScreen] <<Frontend>>
        component [HelpScreen] <<Frontend>>
    }
    
    package "ViewModels" {
        component [LandingViewModel] <<Frontend>>
        component [DashboardViewModel] <<Frontend>>
        component [OperationsViewModel] <<Frontend>>
    }
    
    package "API Routes" {
        component [DashboardAPIRoutes] <<Frontend>>
        component [UploadAPIRoutes] <<Frontend>>
        component [ReportsAPIRoutes] <<Frontend>>
        component [SettingsAPIRoutes] <<Frontend>>
    }
    
    package "Repositories" {
        component [CaseRepository] <<Frontend>>
    }
    
    package "Models" {
        component [CaseModel] <<Frontend>>
    }
    
    package "Common Widgets" {
        component [AppSidebar] <<Frontend>>
        component [AppTopBar] <<Frontend>>
    }
    
    package "Utils" {
        component [PageTransitions] <<Frontend>>
    }
    
    package "Theme" {
        component [AppTheme] <<Frontend>>
    }
}

' ============================================
' BACKEND LAYER (Flask REST API)
' ============================================
package "Flask Backend API" <<Backend>> {
    
    component "run.py" as RunPy <<Backend>>
    
    package "app" {
        component "__init__.py" as AppInit <<Backend>>
        
        package "routes" {
            component "cases_bp" as cases_bp <<Backend>>
        }
        
        package "models" {
            component [Case] <<Backend>>
            component [CaseFile] <<Backend>>
        }
        
        package "services" {
            component [FileService] <<Backend>>
        }
        
        package "utils" {
            component [Validators] <<Backend>>
        }
        
        package "extensions" {
            component [db] <<Backend>>
            component [migrate] <<Backend>>
            component [redis_client] <<Backend>>
            component [task_queue] <<Backend>>
        }
        
        package "tasks" {
            component [analyze_memory_dump] <<Backend>>
        }
    }
    
    component "config.py" as Config <<Backend>>
}

' ============================================
' WORKER PROCESS (RQ Worker)
' ============================================
package "Background Worker" <<Worker>> {
    component "worker.py" as Worker <<Worker>>
}

' ============================================
' CLI TOOL (Memory Analysis Engine)
' ============================================
package "CLI Tool - memflow-cli_v2.py" <<CLI>> {
    
    component [MemflowAnalyzer] <<CLI>>
    
    package "Core Analysis" {
        component [FormatDetection] <<CLI>>
        component [OSDetection] <<CLI>>
        component [VolatilityInterface] <<CLI>>
        component [PluginManager] <<CLI>>
    }
    
    package "Parsers" {
        component [OutputParsers] <<CLI>>
    }
    
    package "Utilities" {
        component [ProgressTracker] <<CLI>>
        component [ColorOutput] <<CLI>>
    }
    
    package "Data Models" {
        component [AnalysisProgress] <<CLI>>
        component [FormatInfo] <<CLI>>
    }
}

' ============================================
' DATABASE
' ============================================
database "PostgreSQL Database" <<Database>> {
    component [cases_table] <<Database>>
    component [case_files_table] <<Database>>
}

' ============================================
' EXTERNAL TOOLS & SERVICES
' ============================================
package "External Tools & Services" <<External>> {
    component [Volatility3] <<External>>
    component [Redis] <<External>>
}

' ============================================
' FILE SYSTEM
' ============================================
storage "File System" {
    folder "data/" {
        folder "case_{id}/" {
            file "raw.mem"
            file "report.json"
        }
    }
}

' ============================================
' RELATIONSHIPS - Frontend Internal
' ============================================
MainApp --> LoginScreen : routes
MainApp --> NewDashboardScreen : routes
MainApp --> UploadCaseScreen : routes
MainApp --> OperationsScreen : routes
MainApp --> ReportsScreen : routes
MainApp --> SettingsScreen : routes
MainApp --> HelpScreen : routes
MainApp --> PageTransitions : uses
MainApp --> AppTheme : uses

NewDashboardScreen --> AppSidebar : uses
NewDashboardScreen --> AppTopBar : uses
NewDashboardScreen --> DashboardViewModel : uses

UploadCaseScreen --> AppSidebar : uses
UploadCaseScreen --> AppTopBar : uses

OperationsScreen --> AppSidebar : uses
OperationsScreen --> AppTopBar : uses
OperationsScreen --> OperationsViewModel : uses

ReportsScreen --> AppSidebar : uses
ReportsScreen --> AppTopBar : uses

SettingsScreen --> AppSidebar : uses
SettingsScreen --> AppTopBar : uses

HelpScreen --> AppSidebar : uses
HelpScreen --> AppTopBar : uses

' ============================================
' RELATIONSHIPS - Frontend to API Routes
' ============================================
DashboardViewModel --> DashboardAPIRoutes : calls
DashboardViewModel --> CaseRepository : uses

UploadCaseScreen --> UploadAPIRoutes : calls
UploadAPIRoutes --> CaseRepository : uses

ReportsScreen --> ReportsAPIRoutes : calls
ReportsAPIRoutes --> CaseRepository : uses

SettingsScreen --> SettingsAPIRoutes : calls

CaseRepository --> CaseModel : returns

' ============================================
' RELATIONSHIPS - Frontend to Backend
' ============================================
DashboardAPIRoutes -down-> cases_bp : HTTP REST API
UploadAPIRoutes -down-> cases_bp : HTTP REST API
ReportsAPIRoutes -down-> cases_bp : HTTP REST API
CaseRepository -down-> cases_bp : HTTP REST API

' ============================================
' RELATIONSHIPS - Backend Internal
' ============================================
RunPy --> AppInit : imports
AppInit --> cases_bp : registers
AppInit --> db : initializes
AppInit --> migrate : initializes
AppInit --> redis_client : initializes
AppInit --> Config : loads

cases_bp --> Case : CRUD operations
cases_bp --> CaseFile : CRUD operations
cases_bp --> FileService : uses
cases_bp --> Validators : validates
cases_bp --> task_queue : enqueues jobs

redis_client --> task_queue : creates
task_queue --> analyze_memory_dump : queues

Case --> db : extends Model
CaseFile --> db : extends Model
Case "1" -- "many" CaseFile : has

' ============================================
' RELATIONSHIPS - Backend to Database
' ============================================
db -down-> cases_table : ORM mapping
db -down-> case_files_table : ORM mapping
cases_table "1" -- "many" case_files_table : FK relationship

' ============================================
' RELATIONSHIPS - Backend to File System
' ============================================
cases_bp -down-> "File System" : stores uploads

' ============================================
' RELATIONSHIPS - Backend to Redis
' ============================================
redis_client -down-> Redis : connects
task_queue -down-> Redis : uses as broker

' ============================================
' RELATIONSHIPS - Worker Process
' ============================================
Worker --> Redis : polls queue
Worker --> analyze_memory_dump : executes task
analyze_memory_dump --> Case : updates status
analyze_memory_dump --> MemflowAnalyzer : invokes

' ============================================
' RELATIONSHIPS - CLI Internal
' ============================================
MemflowAnalyzer --> FormatDetection : uses
MemflowAnalyzer --> OSDetection : uses
MemflowAnalyzer --> VolatilityInterface : uses
MemflowAnalyzer --> ProgressTracker : uses

VolatilityInterface --> PluginManager : selects plugins
VolatilityInterface --> OutputParsers : parses results
VolatilityInterface --> Volatility3 : executes

ProgressTracker --> AnalysisProgress : creates
FormatDetection --> FormatInfo : creates
ColorOutput --> MemflowAnalyzer : formats output

' ============================================
' RELATIONSHIPS - CLI to External
' ============================================
VolatilityInterface -down-> Volatility3 : subprocess calls

' ============================================
' RELATIONSHIPS - CLI to File System
' ============================================
MemflowAnalyzer --> "File System" : reads memory dumps
MemflowAnalyzer --> "File System" : writes reports

' ============================================
' NOTES
' ============================================
note right of "Flutter Desktop Application"
    **Frontend Layer (Updated)**
    - 7 screens with authentication
    - Dedicated API route modules
    - Common widgets (sidebar, topbar)
    - Custom page transitions
    - MVVM architecture
    - Provider state management
end note

note right of "Flask Backend API"
    **Backend Layer (Updated)**
    - RESTful API endpoints
    - Redis/RQ async task queue
    - Background job processing
    - SQLAlchemy ORM
    - File upload handling
    - Database migrations
end note

note right of Worker
    **Background Worker**
    - RQ worker process
    - Polls Redis queue
    - Executes analysis tasks
    - Windows-compatible
    - Graceful shutdown handling
end note

note right of "CLI Tool - memflow-cli_v2.py"
    **Analysis Engine**
    - Memory dump format detection
    - OS detection (Windows/Linux/macOS)
    - Volatility3 integration
    - Parallel plugin execution
    - Progress tracking
    - JSON report generation
end note

note bottom of "PostgreSQL Database"
    **Data Persistence**
    - Case metadata
    - File tracking
    - Analysis results
    - JSONB for flexible metadata
end note

note bottom of Redis
    **Message Broker**
    - Job queue for async tasks
    - RQ (Redis Queue) integration
    - Task status tracking
end note

note bottom of Volatility3
    **External Dependency**
    - Industry-standard tool
    - Plugin-based architecture
    - Supports multiple OS types
end note

' ============================================
' LEGEND
' ============================================
legend right
    |<#E3F2FD> Frontend | Flutter Desktop Application |
    |<#FFF3E0> Backend | Flask REST API |
    |<#FFF9C4> Worker | Background Worker Process |
    |<#E8F5E9> CLI | Memory Analysis CLI Tool |
    |<#F3E5F5> Database | PostgreSQL Database |
    |<#FFEBEE> External | External Tools/Services |
    
    **Communication Patterns:**
    --> : Direct dependency/call
    ..> : Async/queued operation
    -- : Data relationship
    
    **New Components:**
    - Redis task queue system
    - RQ worker process
    - 6 new frontend screens
    - API route modules
endlegend

@enduml